datasource db {
  provider = "mongodb"
  url      = env("MONGODB_URL")
}

generator client {
  provider = "prisma-client-js"
  output   = "./generated/mongo-client"
}

model Message {
  id          String      @id @default(auto()) @map("_id") @db.ObjectId
  channelId   String
  authorId    String
  spans       Span[]     
  attachments Attachment[]
  reactions   Reaction[]
  sentAt      DateTime    @default(now())
  editedAt    DateTime?
  deletedAt   DateTime?
  mentions    Mention[]   // Denormalized for fast querying
}

type Span {
  type        SpanType
  text        String?
  userId      String?     // For USER_MENTION
  specialKind String?     // For SPECIAL_MENTION: "here", "everyone", etc
  channelId   String?     // For CHANNEL_MENTION
  communityId String?     // For COMMUNITY_MENTION
  aliasId     String?     // For ALIAS_MENTION
}

// New enum with more mention types
enum SpanType {
  PLAINTEXT
  USER_MENTION
  SPECIAL_MENTION
  CHANNEL_MENTION
  COMMUNITY_MENTION
  ALIAS_MENTION
}

type Attachment {
  url        String
  filename   String
  filetype   String
  size       Int
}

type Reaction {
  emoji      String
  userIds    String[]
}

// Mentions array denormalized for notifications/etc
type Mention {
  userId      String?
  specialKind String?
  channelId   String?
  communityId String?
  aliasId     String?
}